import json
import pathlib
from typing import List

from salb import Salb, Task

if __name__ == "__main__":
    raw_instance_dir = pathlib.Path()/"instances"/"raw"/"otto-small"
    instance_names = [
        "instance_n=20_1.alb",
        "instance_n=20_10.alb",
        "instance_n=20_100.alb",
        "instance_n=20_101.alb",
        "instance_n=20_102.alb",
        "instance_n=20_103.alb",
        "instance_n=20_104.alb",
        "instance_n=20_105.alb",
        "instance_n=20_106.alb",
        "instance_n=20_107.alb",
        "instance_n=20_108.alb",
        "instance_n=20_109.alb",
        "instance_n=20_11.alb",
        "instance_n=20_110.alb",
        "instance_n=20_111.alb",
        "instance_n=20_112.alb",
        "instance_n=20_113.alb",
        "instance_n=20_114.alb",
        "instance_n=20_115.alb",
        "instance_n=20_116.alb",
        "instance_n=20_117.alb",
        "instance_n=20_118.alb",
        "instance_n=20_119.alb",
        "instance_n=20_12.alb",
        "instance_n=20_120.alb",
        "instance_n=20_121.alb",
        "instance_n=20_122.alb",
        "instance_n=20_123.alb",
        "instance_n=20_124.alb",
        "instance_n=20_125.alb",
        "instance_n=20_126.alb",
        "instance_n=20_127.alb",
        "instance_n=20_128.alb",
        "instance_n=20_129.alb",
        "instance_n=20_13.alb",
        "instance_n=20_130.alb",
        "instance_n=20_131.alb",
        "instance_n=20_132.alb",
        "instance_n=20_133.alb",
        "instance_n=20_134.alb",
        "instance_n=20_135.alb",
        "instance_n=20_136.alb",
        "instance_n=20_137.alb",
        "instance_n=20_138.alb",
        "instance_n=20_139.alb",
        "instance_n=20_14.alb",
        "instance_n=20_140.alb",
        "instance_n=20_141.alb",
        "instance_n=20_142.alb",
        "instance_n=20_143.alb",
        "instance_n=20_144.alb",
        "instance_n=20_145.alb",
        "instance_n=20_146.alb",
        "instance_n=20_147.alb",
        "instance_n=20_148.alb",
        "instance_n=20_149.alb",
        "instance_n=20_15.alb",
        "instance_n=20_150.alb",
        "instance_n=20_151.alb",
        "instance_n=20_152.alb",
        "instance_n=20_153.alb",
        "instance_n=20_154.alb",
        "instance_n=20_155.alb",
        "instance_n=20_156.alb",
        "instance_n=20_157.alb",
        "instance_n=20_158.alb",
        "instance_n=20_159.alb",
        "instance_n=20_16.alb",
        "instance_n=20_160.alb",
        "instance_n=20_161.alb",
        "instance_n=20_162.alb",
        "instance_n=20_163.alb",
        "instance_n=20_164.alb",
        "instance_n=20_165.alb",
        "instance_n=20_166.alb",
        "instance_n=20_167.alb",
        "instance_n=20_168.alb",
        "instance_n=20_169.alb",
        "instance_n=20_17.alb",
        "instance_n=20_170.alb",
        "instance_n=20_171.alb",
        "instance_n=20_172.alb",
        "instance_n=20_173.alb",
        "instance_n=20_174.alb",
        "instance_n=20_175.alb",
        "instance_n=20_176.alb",
        "instance_n=20_177.alb",
        "instance_n=20_178.alb",
        "instance_n=20_179.alb",
        "instance_n=20_18.alb",
        "instance_n=20_180.alb",
        "instance_n=20_181.alb",
        "instance_n=20_182.alb",
        "instance_n=20_183.alb",
        "instance_n=20_184.alb",
        "instance_n=20_185.alb",
        "instance_n=20_186.alb",
        "instance_n=20_187.alb",
        "instance_n=20_188.alb",
        "instance_n=20_189.alb",
        "instance_n=20_19.alb",
        "instance_n=20_190.alb",
        "instance_n=20_191.alb",
        "instance_n=20_192.alb",
        "instance_n=20_193.alb",
        "instance_n=20_194.alb",
        "instance_n=20_195.alb",
        "instance_n=20_196.alb",
        "instance_n=20_197.alb",
        "instance_n=20_198.alb",
        "instance_n=20_199.alb",
        "instance_n=20_2.alb",
        "instance_n=20_20.alb",
        "instance_n=20_200.alb",
        "instance_n=20_201.alb",
        "instance_n=20_202.alb",
        "instance_n=20_203.alb",
        "instance_n=20_204.alb",
        "instance_n=20_205.alb",
        "instance_n=20_206.alb",
        "instance_n=20_207.alb",
        "instance_n=20_208.alb",
        "instance_n=20_209.alb",
        "instance_n=20_21.alb",
        "instance_n=20_210.alb",
        "instance_n=20_211.alb",
        "instance_n=20_212.alb",
        "instance_n=20_213.alb",
        "instance_n=20_214.alb",
        "instance_n=20_215.alb",
        "instance_n=20_216.alb",
        "instance_n=20_217.alb",
        "instance_n=20_218.alb",
        "instance_n=20_219.alb",
        "instance_n=20_22.alb",
        "instance_n=20_220.alb",
        "instance_n=20_221.alb",
        "instance_n=20_222.alb",
        "instance_n=20_223.alb",
        "instance_n=20_224.alb",
        "instance_n=20_225.alb",
        "instance_n=20_226.alb",
        "instance_n=20_227.alb",
        "instance_n=20_228.alb",
        "instance_n=20_229.alb",
        "instance_n=20_23.alb",
        "instance_n=20_230.alb",
        "instance_n=20_231.alb",
        "instance_n=20_232.alb",
        "instance_n=20_233.alb",
        "instance_n=20_234.alb",
        "instance_n=20_235.alb",
        "instance_n=20_236.alb",
        "instance_n=20_237.alb",
        "instance_n=20_238.alb",
        "instance_n=20_239.alb",
        "instance_n=20_24.alb",
        "instance_n=20_240.alb",
        "instance_n=20_241.alb",
        "instance_n=20_242.alb",
        "instance_n=20_243.alb",
        "instance_n=20_244.alb",
        "instance_n=20_245.alb",
        "instance_n=20_246.alb",
        "instance_n=20_247.alb",
        "instance_n=20_248.alb",
        "instance_n=20_249.alb",
        "instance_n=20_25.alb",
        "instance_n=20_250.alb",
        "instance_n=20_251.alb",
        "instance_n=20_252.alb",
        "instance_n=20_253.alb",
        "instance_n=20_254.alb",
        "instance_n=20_255.alb",
        "instance_n=20_256.alb",
        "instance_n=20_257.alb",
        "instance_n=20_258.alb",
        "instance_n=20_259.alb",
        "instance_n=20_26.alb",
        "instance_n=20_260.alb",
        "instance_n=20_261.alb",
        "instance_n=20_262.alb",
        "instance_n=20_263.alb",
        "instance_n=20_264.alb",
        "instance_n=20_265.alb",
        "instance_n=20_266.alb",
        "instance_n=20_267.alb",
        "instance_n=20_268.alb",
        "instance_n=20_269.alb",
        "instance_n=20_27.alb",
        "instance_n=20_270.alb",
        "instance_n=20_271.alb",
        "instance_n=20_272.alb",
        "instance_n=20_273.alb",
        "instance_n=20_274.alb",
        "instance_n=20_275.alb",
        "instance_n=20_276.alb",
        "instance_n=20_277.alb",
        "instance_n=20_278.alb",
        "instance_n=20_279.alb",
        "instance_n=20_28.alb",
        "instance_n=20_280.alb",
        "instance_n=20_281.alb",
        "instance_n=20_282.alb",
        "instance_n=20_283.alb",
        "instance_n=20_284.alb",
        "instance_n=20_285.alb",
        "instance_n=20_286.alb",
        "instance_n=20_287.alb",
        "instance_n=20_288.alb",
        "instance_n=20_289.alb",
        "instance_n=20_29.alb",
        "instance_n=20_290.alb",
        "instance_n=20_291.alb",
        "instance_n=20_292.alb",
        "instance_n=20_293.alb",
        "instance_n=20_294.alb",
        "instance_n=20_295.alb",
        "instance_n=20_296.alb",
        "instance_n=20_297.alb",
        "instance_n=20_298.alb",
        "instance_n=20_299.alb",
        "instance_n=20_3.alb",
        "instance_n=20_30.alb",
        "instance_n=20_300.alb",
        "instance_n=20_301.alb",
        "instance_n=20_302.alb",
        "instance_n=20_303.alb",
        "instance_n=20_304.alb",
        "instance_n=20_305.alb",
        "instance_n=20_306.alb",
        "instance_n=20_307.alb",
        "instance_n=20_308.alb",
        "instance_n=20_309.alb",
        "instance_n=20_31.alb",
        "instance_n=20_310.alb",
        "instance_n=20_311.alb",
        "instance_n=20_312.alb",
        "instance_n=20_313.alb",
        "instance_n=20_314.alb",
        "instance_n=20_315.alb",
        "instance_n=20_316.alb",
        "instance_n=20_317.alb",
        "instance_n=20_318.alb",
        "instance_n=20_319.alb",
        "instance_n=20_32.alb",
        "instance_n=20_320.alb",
        "instance_n=20_321.alb",
        "instance_n=20_322.alb",
        "instance_n=20_323.alb",
        "instance_n=20_324.alb",
        "instance_n=20_325.alb",
        "instance_n=20_326.alb",
        "instance_n=20_327.alb",
        "instance_n=20_328.alb",
        "instance_n=20_329.alb",
        "instance_n=20_33.alb",
        "instance_n=20_330.alb",
        "instance_n=20_331.alb",
        "instance_n=20_332.alb",
        "instance_n=20_333.alb",
        "instance_n=20_334.alb",
        "instance_n=20_335.alb",
        "instance_n=20_336.alb",
        "instance_n=20_337.alb",
        "instance_n=20_338.alb",
        "instance_n=20_339.alb",
        "instance_n=20_34.alb",
        "instance_n=20_340.alb",
        "instance_n=20_341.alb",
        "instance_n=20_342.alb",
        "instance_n=20_343.alb",
        "instance_n=20_344.alb",
        "instance_n=20_345.alb",
        "instance_n=20_346.alb",
        "instance_n=20_347.alb",
        "instance_n=20_348.alb",
        "instance_n=20_349.alb",
        "instance_n=20_35.alb",
        "instance_n=20_350.alb",
        "instance_n=20_351.alb",
        "instance_n=20_352.alb",
        "instance_n=20_353.alb",
        "instance_n=20_354.alb",
        "instance_n=20_355.alb",
        "instance_n=20_356.alb",
        "instance_n=20_357.alb",
        "instance_n=20_358.alb",
        "instance_n=20_359.alb",
        "instance_n=20_36.alb",
        "instance_n=20_360.alb",
        "instance_n=20_361.alb",
        "instance_n=20_362.alb",
        "instance_n=20_363.alb",
        "instance_n=20_364.alb",
        "instance_n=20_365.alb",
        "instance_n=20_366.alb",
        "instance_n=20_367.alb",
        "instance_n=20_368.alb",
        "instance_n=20_369.alb",
        "instance_n=20_37.alb",
        "instance_n=20_370.alb",
        "instance_n=20_371.alb",
        "instance_n=20_372.alb",
        "instance_n=20_373.alb",
        "instance_n=20_374.alb",
        "instance_n=20_375.alb",
        "instance_n=20_376.alb",
        "instance_n=20_377.alb",
        "instance_n=20_378.alb",
        "instance_n=20_379.alb",
        "instance_n=20_38.alb",
        "instance_n=20_380.alb",
        "instance_n=20_381.alb",
        "instance_n=20_382.alb",
        "instance_n=20_383.alb",
        "instance_n=20_384.alb",
        "instance_n=20_385.alb",
        "instance_n=20_386.alb",
        "instance_n=20_387.alb",
        "instance_n=20_388.alb",
        "instance_n=20_389.alb",
        "instance_n=20_39.alb",
        "instance_n=20_390.alb",
        "instance_n=20_391.alb",
        "instance_n=20_392.alb",
        "instance_n=20_393.alb",
        "instance_n=20_394.alb",
        "instance_n=20_395.alb",
        "instance_n=20_396.alb",
        "instance_n=20_397.alb",
        "instance_n=20_398.alb",
        "instance_n=20_399.alb",
        "instance_n=20_4.alb",
        "instance_n=20_40.alb",
        "instance_n=20_400.alb",
        "instance_n=20_401.alb",
        "instance_n=20_402.alb",
        "instance_n=20_403.alb",
        "instance_n=20_404.alb",
        "instance_n=20_405.alb",
        "instance_n=20_406.alb",
        "instance_n=20_407.alb",
        "instance_n=20_408.alb",
        "instance_n=20_409.alb",
        "instance_n=20_41.alb",
        "instance_n=20_410.alb",
        "instance_n=20_411.alb",
        "instance_n=20_412.alb",
        "instance_n=20_413.alb",
        "instance_n=20_414.alb",
        "instance_n=20_415.alb",
        "instance_n=20_416.alb",
        "instance_n=20_417.alb",
        "instance_n=20_418.alb",
        "instance_n=20_419.alb",
        "instance_n=20_42.alb",
        "instance_n=20_420.alb",
        "instance_n=20_421.alb",
        "instance_n=20_422.alb",
        "instance_n=20_423.alb",
        "instance_n=20_424.alb",
        "instance_n=20_425.alb",
        "instance_n=20_426.alb",
        "instance_n=20_427.alb",
        "instance_n=20_428.alb",
        "instance_n=20_429.alb",
        "instance_n=20_43.alb",
        "instance_n=20_430.alb",
        "instance_n=20_431.alb",
        "instance_n=20_432.alb",
        "instance_n=20_433.alb",
        "instance_n=20_434.alb",
        "instance_n=20_435.alb",
        "instance_n=20_436.alb",
        "instance_n=20_437.alb",
        "instance_n=20_438.alb",
        "instance_n=20_439.alb",
        "instance_n=20_44.alb",
        "instance_n=20_440.alb",
        "instance_n=20_441.alb",
        "instance_n=20_442.alb",
        "instance_n=20_443.alb",
        "instance_n=20_444.alb",
        "instance_n=20_445.alb",
        "instance_n=20_446.alb",
        "instance_n=20_447.alb",
        "instance_n=20_448.alb",
        "instance_n=20_449.alb",
        "instance_n=20_45.alb",
        "instance_n=20_450.alb",
        "instance_n=20_451.alb",
        "instance_n=20_452.alb",
        "instance_n=20_453.alb",
        "instance_n=20_454.alb",
        "instance_n=20_455.alb",
        "instance_n=20_456.alb",
        "instance_n=20_457.alb",
        "instance_n=20_458.alb",
        "instance_n=20_459.alb",
        "instance_n=20_46.alb",
        "instance_n=20_460.alb",
        "instance_n=20_461.alb",
        "instance_n=20_462.alb",
        "instance_n=20_463.alb",
        "instance_n=20_464.alb",
        "instance_n=20_465.alb",
        "instance_n=20_466.alb",
        "instance_n=20_467.alb",
        "instance_n=20_468.alb",
        "instance_n=20_469.alb",
        "instance_n=20_47.alb",
        "instance_n=20_470.alb",
        "instance_n=20_471.alb",
        "instance_n=20_472.alb",
        "instance_n=20_473.alb",
        "instance_n=20_474.alb",
        "instance_n=20_475.alb",
        "instance_n=20_476.alb",
        "instance_n=20_477.alb",
        "instance_n=20_478.alb",
        "instance_n=20_479.alb",
        "instance_n=20_48.alb",
        "instance_n=20_480.alb",
        "instance_n=20_481.alb",
        "instance_n=20_482.alb",
        "instance_n=20_483.alb",
        "instance_n=20_484.alb",
        "instance_n=20_485.alb",
        "instance_n=20_486.alb",
        "instance_n=20_487.alb",
        "instance_n=20_488.alb",
        "instance_n=20_489.alb",
        "instance_n=20_49.alb",
        "instance_n=20_490.alb",
        "instance_n=20_491.alb",
        "instance_n=20_492.alb",
        "instance_n=20_493.alb",
        "instance_n=20_494.alb",
        "instance_n=20_495.alb",
        "instance_n=20_496.alb",
        "instance_n=20_497.alb",
        "instance_n=20_498.alb",
        "instance_n=20_499.alb",
        "instance_n=20_5.alb",
        "instance_n=20_50.alb",
        "instance_n=20_500.alb",
        "instance_n=20_501.alb",
        "instance_n=20_502.alb",
        "instance_n=20_503.alb",
        "instance_n=20_504.alb",
        "instance_n=20_505.alb",
        "instance_n=20_506.alb",
        "instance_n=20_507.alb",
        "instance_n=20_508.alb",
        "instance_n=20_509.alb",
        "instance_n=20_51.alb",
        "instance_n=20_510.alb",
        "instance_n=20_511.alb",
        "instance_n=20_512.alb",
        "instance_n=20_513.alb",
        "instance_n=20_514.alb",
        "instance_n=20_515.alb",
        "instance_n=20_516.alb",
        "instance_n=20_517.alb",
        "instance_n=20_518.alb",
        "instance_n=20_519.alb",
        "instance_n=20_52.alb",
        "instance_n=20_520.alb",
        "instance_n=20_521.alb",
        "instance_n=20_522.alb",
        "instance_n=20_523.alb",
        "instance_n=20_524.alb",
        "instance_n=20_525.alb",
        "instance_n=20_53.alb",
        "instance_n=20_54.alb",
        "instance_n=20_55.alb",
        "instance_n=20_56.alb",
        "instance_n=20_57.alb",
        "instance_n=20_58.alb",
        "instance_n=20_59.alb",
        "instance_n=20_6.alb",
        "instance_n=20_60.alb",
        "instance_n=20_61.alb",
        "instance_n=20_62.alb",
        "instance_n=20_63.alb",
        "instance_n=20_64.alb",
        "instance_n=20_65.alb",
        "instance_n=20_66.alb",
        "instance_n=20_67.alb",
        "instance_n=20_68.alb",
        "instance_n=20_69.alb",
        "instance_n=20_7.alb",
        "instance_n=20_70.alb",
        "instance_n=20_71.alb",
        "instance_n=20_72.alb",
        "instance_n=20_73.alb",
        "instance_n=20_74.alb",
        "instance_n=20_75.alb",
        "instance_n=20_76.alb",
        "instance_n=20_77.alb",
        "instance_n=20_78.alb",
        "instance_n=20_79.alb",
        "instance_n=20_8.alb",
        "instance_n=20_80.alb",
        "instance_n=20_81.alb",
        "instance_n=20_82.alb",
        "instance_n=20_83.alb",
        "instance_n=20_84.alb",
        "instance_n=20_85.alb",
        "instance_n=20_86.alb",
        "instance_n=20_87.alb",
        "instance_n=20_88.alb",
        "instance_n=20_89.alb",
        "instance_n=20_9.alb",
        "instance_n=20_90.alb",
        "instance_n=20_91.alb",
        "instance_n=20_92.alb",
        "instance_n=20_93.alb",
        "instance_n=20_94.alb",
        "instance_n=20_95.alb",
        "instance_n=20_96.alb",
        "instance_n=20_97.alb",
        "instance_n=20_98.alb",
        "instance_n=20_99.alb",
    ]
    for instance_name in instance_names:
        raw_instance_path = raw_instance_dir/instance_name
        
        instance_dict = {}
        instance_dict["tasks"] = []
        lines = []
        with open(raw_instance_path.absolute(), "r") as f:
            lines = f.readlines()
        num_tasks = int(lines[1])
        si = 0
        while ("<task times>" not in lines[si]):
            si+=1
        si+=1
        for i in range(num_tasks):
            line = lines[si+i].split(" ")
            idx, task_time = int(line[0]), float(line[1])
            instance_dict["tasks"].append({
                "idx":idx, 
                "task_time":task_time
            })
        
        si += num_tasks + 1
        while ("<precedence relations>" not in lines[si]):
            si += 1
        si += 1
        instance_dict["precedence_list"] = []
        while ("<end>" not in lines[si]):    
            print(lines[si]) 
            if len(lines[si])<=1:
                break
            precedence = lines[si].split(",")
            idxa, idxb = int(precedence[0]), int(precedence[1])
            instance_dict["precedence_list"].append({
                "i":idxa,
                "j":idxb
            })
            si += 1

        converted_instance_dir = pathlib.Path()/"instances"
        converted_instance_name = instance_name[:-3]+"json"
        converted_instance_path = converted_instance_dir/converted_instance_name
        with open(converted_instance_path.absolute(), "w") as f:
            json.dump(instance_dict, f, indent=4)